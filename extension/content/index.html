<html>

<head>
  <base href="chrome://jetpack/content/"/>
  <base target="_blank"/>
  <link rel="stylesheet" type="text/css" media="all"
        href="css/index.css" />
  <title>I am Jetpack.</title>
</head>

<body>
<div id="content">

<!-- MASTHEAD -->

<img src="gfx/jetpack.png"/><br/>  

<!-- TABS -->

<div id="container">
  <ul>
    <li><a href="#welcome"><span>Welcome</span></a></li>
    <li><a href="#develop"><span>Develop</span></a></li>
    <li><a href="#installed"><span>Installed Features</span></a></li>
    <li><a href="#memory"><span>Memory Usage</span></a></li>
    <li><a href="#tests"><span>Test Suite</span></a></li>      
    <li><a href="#tutorial"><span>Tutorial</span></a></li>
  </ul>  
  
  <!-- WELCOME TAB -->

  <div id="welcome">
    <h1>I am Jetpack. Welcome.</h1>
    <p><i>Exploring new ways to extend &amp; personalize the Web.</i></p>
    
    <p>The <a href="https://addons.mozilla.org">add-ons community for
      Firefox</a> is arguably one of the largest, most vibrant sources
      for innovation on the Web today.  If you want to affect people,
      to reach them and make a difference in their daily lives, the
      Firefox <a
      href="https://developer.mozilla.org/En/Developing_add-ons">add-ons
      platform</a> is hard to beat, with over
    <a
      href="http://blog.mozilla.com/addons/2008/11/19/1-billion-add-on-downloads/">one
      billion installs of Firefox add-ons to date</a>.
    </p>

    <p>However, we've only scratched the surface of its potential.</p>

    <p>Jetpack lets you build Firefox (and more!) extensions with the
      same skill-set you already know from building on the open Web:
      Javascript, HTML, and CSS. We've even got jQuery included by
      default to ease you into it.</p>
      
    <p>Make sure to visit the <a href="https://jetpack.mozillalabs.com/">Jetpack website</a>!</p>
      
    <h2>Demo Jetpack Features</h2>
    
    <ul>
      <li><a href="demos/unad-install.html">UnAd - Content Filter Demo</a> &mdash; Demonstrates in ~80 lines of code how to build a Jetpack feature that can remove unwanted scripts, images, and iframes with a pretty UI for turning the feature on and off. It uses a blocklist created for AdBlock Plus.<br/><br/></li>
      <li><a
      href="chrome://jetpack/content/demos/gmail-checker-install.html">Email Notifier - Status Bar Demo</a> &mdash; It's easy to make useful indicators, gauges, and ambient information displays when you have the full power of HTML and CSS. In this demo, we create a Gmail notifier in ~50 lines of code.</li>
    </ul>
  </div>
  
  
  <!-- DEVELOP TAB -->
  
  <div id="develop">
    <div class="developer-warnings"></div>
    <h2>Developing With Jetpack</h2>
    
    <p>If you want to create a Jetpack feature, use the editor
    below.</p> <p>Read the <span class="buttony
    tutorial-link">tutorial</span> for a quick tour of the
    basics&mdash;or, if you prefer, check out the <a
    href="chrome://jetpack/content/file.html#index.html#content/js/jetpack-library-doc.js">Jetpack
    Library documentation</a>.</p>

    <div class="editor-widget" id="editor-widget-container"></div>    
    <p><span class="buttony" id="reload-editor-code">try out this
    code</span></p>

    <p>If you want to hack on the Jetpack platform itself, the vast
    majority of it is contained in the <span class="buttony"
    id="this-page-source-code">source code for this page</span>. Just make
    local changes to the file or one of the scripts it refers to and
    reload this page.</p>

    <h2>About This Page</h2>
    <p>This page actually houses the Jetpack platform. All your Jetpacks
    are loaded in this page, and you can even use Firebug to inspect
    their current state.</p>
    <p>As a result, the lifetime of your Jetpacks is tied to the
    lifetime of this page. When you reload this page, for instance, all
    your Jetpacks are reloaded. This means that the time between making
    a change to a Jetpack and seeing its effects is as small as
    possible&mdash;you never have to restart your browser.</p>
    <p>Because it only makes sense for one instance of Jetpack to exist
    at a time, this page is what developers call a <i>singleton</i>:
    only one instance of it can exist at once.  Try opening this URL in
    two tabs at once and see what happens!</p>
    <p>Finally, the Jetpack singleton always exists, since users
    obviously need to be able to use their Jetpacks without having
    Jetpack open in a tab.  If you close the Jetpack tab, it'll actually
    re-open in a hidden browser that you can't see.</p> 
  </div>
  
  
  <!-- INSTALLED FEATURES TAB -->
  
  <div id="installed">
    <h2>Your Jetpack Features</h2>
    <div class="summary"></div>
    <div id="installed-jetpacks" class="jetpack-list">
    </div>
    <div id="uninstalled-jetpacks" class="jetpack-list">
      <p>These are your recently-uninstalled Jetpack Features. You can
      reinstall them easily from here, or you can purge them from this
      list so they no longer clutter this page.</p>
    </div>
  </div>

  <!-- MEMORY USAGE TAB -->
  
  <div id="memory">
    <h2>Memory Usage</h2>
    <p>Below is a list of all live objects being tracked by Jetpack. If
    one of these numbers never goes down, then your Jetpack either has a
    memory leak or isn't using memory very effectively.</p>
    <div id="extension-weakrefs"></div>
    <p id="memory-usage-actions"p>
      <span class="buttony" id="force-gc">force garbage collection</span>
    </p>
  </div>
    
  <!-- TEST SUITE TAB -->
  
  <div id="tests">
    <h2>Test Suites</h2>
    <p>At the moment, you can run the <span class="buttony"
    id="run-tests">Jetpack platform test suite</span>. In the future,
    you'll be able to run the test suites for individual Jetpacks
    here.</p>
    <p>All output for the suites is sent to the <span
    class="logging-source"></span>.</p>    
  </div>

  <!-- TUTORIAL TAB -->
  
  <div id="tutorial">
    <div class="developer-warnings"></div>
    <p>Welcome to the Jetpack API tutorial. By the end of this
    tutorial, you'll have learned how to make a Jetpack Feature that
    removes all embeds &mdash; Flash movies, etc &mdash; from a
    particular page or all websites. The code required is never more
    lines than a polydactylic man can count on both hands.</p>

    <h2>Chapter 0: Get going</h2>

    <p>One of the primary goals of Jetpack is to have development be a
    real-time adventure. We know that tight feedback loops, a good
    debugger, and instant gratification makes for happy coders. That's
    why refreshing a Jetpack Feature is literally as simple as
    refreshing a webpage, and why we try to have all errors be
    reported sensibly and with line number!</p>

    <p>Let's get going.</p>

    <p>There are two ways of getting started. If you are reading this
    inside of Jetpack, then you can play with the code
    live. Otherwise, go to <a href="about:jetpack">about:jetpack</a>
    and type in the code examples.</p>

    <h2>Chapter 1: The boom stick</h2>

    <p>Admit it. Have you always wanted a button in your browser that
    let's you make things go boom? I know I have. So that's the first
    thing that we are going to make. Let's begin by adding a widget to
    the status bar that contains the prophetic message "Boom!":</p>

    <div class="example">jetpack.statusBar.append({
  html: "Boom<i>!</i>"
});</div>

    <p>Click the install button, and there it is, large as life in the
    status bar. Notice the conspicuous lack of restarts! As you can
    see, <code>statusBar.append</code> takes an options
    object. Instead of passing in html, you can use the
    <code>url</code> keyword and pass it a relative url.</p>

    <p>Right now the widget is probably way too wide &mdash; that's
    because we haven't yet added the auto-sizing feature to
    Jetpack. For now, you'll have to pass in the width.</p>

    <div class="example">jetpack.statusBar.append({
  html: "Boom<i>!</i>",
  width: 45
});</div>

    <p>That's nice, but just having a "Boom!" in your status bar isn't
    all that exciting. Let's make it <i>do</i> something.</p>

    <div class="example">jetpack.statusBar.append({
  html: "Boom<i>!</i>",
  width: 45,
  onReady: function(widget){
    $(widget).click(function(){
      console.log( jetpack.tabs );
    });
  }
});</div>

    <p>Now, whenever you click on the widget, it logs the
    <code>jetpack.tabs</code> object to the Firebug console. Instead
    of reinventing the wheel, to debug Jetpack Features we've made
    Firebug the tool of choice. It's easy to introspect to learn more
    &mdash; for instance by delving in, you'll quickly find the
    <code>jetpack.tabs.focused</code> object, which gives you access
    to the currently active tab.</p>

    <p>You can also see that we've automatically included jQuery by
    default. In the future, we hope to include other libraries. Feel
    free to fiddle around with the code, and see what you come up
    with.</p>

    <p>Let's make our little Boom! widget do something more fun:</p>

    <div class="example">jetpack.statusBar.append({
  html: "Boom<i>!</i>",
  width: 45,
  onReady: function(widget){
    $(widget).click(function(){
      jetpack.notifications.show( "Booming!" );
      $(jetpack.tabs.focused.contentDocument)
        .find("body")
        .css({backgroundColor:"red"})
        .animate({opacity:.5});
    });
  }
});</div>

    <p>Give it a go and see what it does. Every <code>tab</code>
    object has a wealth of possible event listeners, and
    properties. Take a look via Firebug or check out the <a
    href="file.html#index.html">documentation</a>. Just like an
    iframe, one of the properties is <code>contentDocument</code>,
    which gives you access to the the equivalent of the document for
    the page in the specified tab. Alternatively, you can use
    <code>contentWindow</code> to get access to the object which
    houses the page's <code>.alert()</code> function, and so
    forth.</p>

    <p>When you want a light-weight way to inform your users of a bit
    of information, <code>jetpack.notifications.show()</code> may be
    the way to go. On Windows and Linux, these show up as <a
    href="http://en.wikipedia.org/wiki/Toast_(computing)">toast
    notifications</a> and on OS X as <a
    href="http://growl.info/">Growl notifications</a>.</p>

    <p>Let's turn away from our new-found ability to make pages blush,
    and instead to the ability to remove embeds from a page. It's one
    line of jQuery goodness.</p>

    <div class="example">jetpack.statusBar.append({
  html: "Boom<i>!</i>",
  width: 45,
  onReady: function(widget){
    $(widget).click(function(){
      var doc = jetpack.tabs.focused.contentDocument;
      $(doc).find("embed").remove();
    });
  }
});</div>


    <p>Pretty good, huh? Less than ten lines of code gets us an
    on-demand embed killer.</p>


    <h2>Chapter 2: The automatic boom</h3>

    <p>We can now get rid of embeds on demand, but that requires
    clicking the Boom! button on every page. What if we instead wanted
    to to enable/disable the functionality for all sites? That's where
    the magic of <code>jetpack.tabs.onReady</code> comes in. It allows
    you to code on every navigation action, just a new page loads but
    before iframes, images, and scripts are fetched. To wait until
    everything is loaded, you can use
    <code>jetpack.tabs.onLoad</code>. Jetpack takes care of all the
    difficult edge cases, like dealing with multiple windows and new
    tabs. Jetpack also handles removing event handlers when you reload
    a Jetpack Feature, so that you never have to restart Firefox due
    to errant event handlers.</p>

    <div class="example">function removeEmbeds(doc){
  $(doc).find("embed").remove();
}

jetpack.statusBar.append({
  html: 'Boom?<input type="checkbox">',
  width: 70,
  onReady: function(widget){
    $("input", widget).click(function(){
      if( this.checked ){
        jetpack.tabs.onReady( removeEmbeds );
        removeEmbeds(jetpack.tabs.focused.contentDocument);
      }
      else jetpack.tabs.onReady.unbind( removeEmbeds );
    });
  }
});</div>

    <p>One of the neat additions we've made is how you remove an event
    handler. Instead of passing in a string, you just call the
    <code>unbind</code> function which is a property of the event
    handling function.</p>

    <h2>Chapter 3: Libraries</h2>

    <p>Reusable code is at the heart of any good API. That's why
    Jetpack includes a "standard library" of common web APIs. At the
    moment, we've only implemented a Twitter library. In the future,
    there should be many more, including the ability to import
    libraries not included with Jetpack by default. (And for
    developers to contribute their APIs for others to use.)</p>

    <p>Here's a simple Jetpack Feature that shows the Twitter library
    in use. It allows you to be notified of someone's latest
    Tweet.</p>

    <div class="example">var twitter = jetpack.lib.twitter
var oldTweet = null;

function getTweet(){
  twitter.getTwitLatestStatus( "osunick", function(tweet){
    var newTweet = tweet.text;
    if( oldTweet != newTweet ){
      jetpack.notifications.show( newTweet );
      oldTweet = newTweet;
    }
  });
}

getTweet();
setInterval( getTweet, 1000*60 );
</div>

    <p>Jetpack is smart enough to clear any <code>setInterval</code>'s
    or <code>setTimeout</code>'s that you use when you refresh your
    Jetpack.</p>

    <p>For now, the easiest way to get documentation on the Twitter
    library is to read the <a
    href="file.html#index.html#content/js/twitter.js">commented
    source</a>.</p>

    <h2>Chapter 4: Email Notifier</h2>

    <p>Putting it all together, you should now be able to be able to
    read through the following example, which displays the number of
    unread emails in your inbox. The only new API calls here are
    <code>jetpack.tabs.open(url)</code> and
    <code>tab.focus()</code>.</p>

    <div class="example">function GmailNotifier(doc){
  $(doc).click( this.goToInbox );
  this.update( doc );
  setInterval( function(){
    this.update(doc);
  }, 60*1000 );
}

GmailNotifier.prototype = {
  goToInbox: function(){
    jetpack.tabs.open("http://mail.google.com");
    jetpack.tabs[ Jetpack.tabs.length-1 ].focus();
  },
  
  update: function(doc){
    var url = "http://mail.google.com/mail/feed/atom";
    doc = $(doc);
    $.get( url, function(xml){
      var el = $(xml).find("fullcount"); // Unread message count

      if( el ){
        var count = el.get(0).textContent;
        doc.find("#count").text( count );
      }
      else{
        doc.find("#count").text( "Login" );
      }
    });
  }
}

jetpack.statusBar.append({
  html: '<img src="http://mail.google.com/mail/images/favicon.ico"/><span id="count"></span>',
  onReady: function(doc){
    var gmail = new GmailNotifier(doc);
    $("#count", doc).css({
      position: "absolute",
      left: 4, top: 8,
      fontSize: "10px",
      cursor: "pointer",
      backgroundColor: "rgba(255,255,255,.8)"
    });
  },
  width: 20
});</div>

    <h2>Chapter 5: The future</h2>

    <p>There's a lot more coming with Jetpack, so check back often.</p>
  </div>
</div>
</div>

<!-- MESSAGES -->

<div class="messages">
  <div class="installed-jetpacks">
    <p class="has-many">You have <span class="installed-count"></span>
    installed Jetpack Features.</p>
    <p class="has-1">You have one installed Jetpack Feature.</p>
    <p class="has-0">You have no installed Jetpack Features.</p>
  </div>
</div>

<!-- WARNINGS -->

<div class="warnings">
    <p id="old-firefox-version" class="warning">You appear to be running
    Firefox 3 or earlier, which means that any logging messages or
    errors produced by your Jetpacks will reference the wrong line numbers.
    This makes debugging Jetpacks difficult; please consider using <a
    href="http://www.mozilla.com/en-US/firefox/all-beta.html">Firefox 3.5
    Beta</a>.</p>
    <p id="firebug-not-found" class="warning">You either don't have the
    latest version of Firebug installed, or you don't have it enabled for
    this page, so all logging messages will appear in the <span
    class="logging-source"></span>. If you get <a
    href="http://getfirebug.com/releases/index.html">Firebug 1.4 Alpha</a>
    and enable it for this page, and then reload this page, all logging
    messages will be logged to the Firebug Console, where it's much easier
    to debug problems and inspect live objects.</p>
    <div id="firebug-caveats" class="warning">You appear to have Firebug
    installed, which is great, because you'll be able to easily debug
    problems and inspect live objects in the <span
    class="logging-source"></span>. However, please note that there's
    still a few rough edges in Jetpack's Firebug integration that you
    should be aware of:
    <ul>
      <li>Firebug seems to get confused if you have this page and another
      website with Firebug enabled in the same browser window. The safe
      and easy way to get around this is to just have this page open
      in its own browser window.</li>
      <li>Whenever you inspect live objects in Firebug, Firebug appears
      to hold on to those objects for the rest of your Firefox session,
      which means that you'll see object reference counts go up in
      the Memory Usage area.</li>
    </ul>
    We apologize for these inconveniences and will be working with the
    Firebug team to resolve them soon.
    </div>
</div>

<!-- CODE -->

<!-- Jetpack Platform Foundation -->
<script src="js/init-extension.js"></script>
<script src="js/ext/jquery.js"></script>
<script src="js/jquery-setup.js"></script>
<script src="js/log.js"></script>
<script src="js/observe.js"></script>
<!-- Jetpack Libraries -->
<script src="js/status-bar-panel.js"></script>
<script src="js/twitter.js"></script>
<script src="js/timers.js"></script>
<script src="js/notifications.js"></script>
<script src="js/jetpack-library.js"></script>
<script src="js/jetpack-runtime.js"></script>
<!-- Test Framework and Suites -->
<script src="js/test.js"></script>
<script src="js/tests/test-log.js"></script>
<script src="js/tests/test-jetpack-library.js"></script>
<script src="js/tests/test-jetpack-runtime.js"></script>
<script src="js/tests/test-status-bar-panel.js"></script>
<!-- Page Interaction -->
<script src="js/ext/jquery.tabs.js"></script>
<script src="js/app.js"></script>
<!-- Code Editor -->
<script src="js/ext/io.js"></script>
<script src="js/editor.js"></script>

</body>
</html>
